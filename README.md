# 견적서 양식 앱 (Google Sheets + Apps Script)

구글 시트에서 견적 데이터를 관리하고, Google Apps Script로 **선택한 견적번호 기준 PDF 견적서**를 생성하는 미니 앱입니다. 현재는 기본 동작이 완성된 상태이며, 몇 가지 기능은 **미완성/추가 작업** 상태입니다.  
이 README는 **공개용 새 레포로 파일만 이관**하는 것을 전제로 정리했습니다.

## 구성 파일

- `Code.js`: 스프레드시트 메뉴 추가 + 견적서 PDF 생성 로직
- `template.html`: Apps Script에서 PDF로 렌더링하는 견적서 템플릿(현재 사용 중)
- `template-preview.html`: 로컬 미리보기용 템플릿(더미데이터 기반)
- `preview-data.js`: 로컬 미리보기용 더미데이터
- `pdf-link.html`: PDF 저장 후 링크 버튼만 보여주는 모달 템플릿
- `appsscript.json`: Apps Script 설정

## 동작 방식 요약

1. 스프레드시트가 열릴 때 상단 메뉴에 **견적서 → 선택 견적번호로 PDF 생성** 메뉴가 생성됩니다.
2. 사용자가 특정 행을 선택하고 메뉴를 실행하면, 해당 행의 `견적번호` 값을 기준으로 같은 견적번호를 가진 모든 행을 모읍니다.
3. 품목은 **품명 기준으로 정렬**한 뒤 템플릿(`template.html`)에 데이터를 주입합니다.
4. HTML을 **PDF로 렌더링하여 저장**하고, 저장된 PDF 링크를 모달(`pdf-link.html`)로 표시합니다.

## 시트 헤더 형식 (필수)

아래 컬럼명이 **정확히 일치**해야 작동합니다.

- `견적번호`
- `견적일`
- `업체명`
- `수신자`
- `품명`
- `규격`
- `수량`
- `단가`
- `비고`

> 헤더명이 틀리거나 누락되면 오류가 발생합니다.

## 사용 방법

1. 구글 시트에 위 헤더를 1행에 입력하고 데이터를 추가합니다.
2. `설정` 시트를 만들고 아래 키/값을 입력합니다.
3. Apps Script 프로젝트에 `Code.js`, `template.html`을 붙여넣습니다.
4. 시트를 새로고침하면 메뉴에 **견적서** 항목이 생성됩니다.
5. 견적서를 만들고 싶은 행(또는 견적번호 셀)을 선택합니다.
6. **견적서 → 선택 견적번호로 PDF 생성**을 클릭합니다.

## 설정 시트 (필수)

시트명: `설정`  
형식: A열=키, B열=값

|키|값|
|---|---|
|공급자_상호|회사명|
|공급자_대표자|대표자명|
|공급자_등록번호|사업자등록번호|
|공급자_사업장주소|주소|
|공급자_업태|업태|
|공급자_종목|종목|
|공급자_연락처|연락처|
|공급자_이메일| |
|공급자_팩스| |

## 커스터마이징 포인트

- `template.html`
  - 레이아웃/폰트/컬러 조정
  - 품명 중복 시 셀 병합 표시(세로 가운데 정렬)
- `Code.js`
  - PDF 저장 폴더 변경 (`DriveApp.getRootFolder()` → 폴더 ID 사용)
  - 부가세율 변경(현재 10% 고정)
  - 견적번호 생성/자동 증가 기능 추가

## 템플릿 로컬 미리보기 (Live Server)

Apps Script 없이도 템플릿을 빠르게 수정/확인할 수 있습니다.

1. VS Code 확장 `Live Server` 설치
2. `template-preview.html`을 열고 **Open with Live Server** 실행
3. `template-preview.html` / `preview-data.js`를 수정하면 즉시 반영
4. 템플릿 수정이 끝나면 변경 내용을 `template.html`에 반영

> `template.html`은 Apps Script 전용 템플릿입니다. 로컬 미리보기는 `template-preview.html`을 사용하세요.

## PDF 저장 및 링크 표시

- PDF는 `template.html`을 렌더링한 결과를 **PDF로 변환**하여 저장합니다.
- 저장 위치: **드라이브 루트/견적서/**, 파일명은 `견적번호.pdf`
- 저장 완료 후 `pdf-link.html` 모달에서 **PDF 열기 버튼**이 표시됩니다.

## 미리보기 모달

현재는 **미리보기 모달 표시가 주석 처리**되어 있습니다. 필요하면 `Code.js`의
`showModalDialog` 부분을 다시 활성화하세요.

## 템플릿 동기화 (preview → template)

`template-preview.html`에서 수정한 내용을 `template.html`에 자동으로 반영하는 스크립트가 포함되어 있습니다.

### 동작 방식

- `template-preview.html`의 SYNC 마커 구간(`STYLE`, `BODY`)만 추출해서
  `template.html`의 동일 구간을 치환합니다.
- Apps Script 전용 스크립트(`<?!= ... ?>`)는 마커 밖에 있어 건드리지 않습니다.

### 실행 방법

컨테이너(또는 로컬) 터미널에서 아래 명령을 실행합니다.

```
node scripts/sync-template-from-preview.js
```

## 미완성/작업 예정 (TODO)

- PDF 저장 폴더 선택 기능(폴더 ID 설정 UI)
- 견적번호 자동 생성 규칙
- VAT 계산 옵션(면세/과세, 수동 입력 지원)
- 미리보기/다운로드 UI 개선
- 시트 유효성 검사 강화(숫자/날짜 검증)
- ui 버튼 두개로 분리 : pdf 저장하는 버튼과 미리보기 버튼

### 품목별 '금액' 계산에 로직 적용
- 단가가 숫자면 단가와 수량을 곱한 금액으로, 시트의 금액 열 숫자는 무시
- 단가가 숫자가 아니면 시트의 금액 열의 숫자를 가져오고

### 할인 기능
- 품명이 '할인' 인 행은 다른 품목과 달리 vat 계산 전에 그 금액만큼 더한다 (시트에 음수로 기재되어 있음)
- 그 행이 없으면 서식에서도 표시되지 않아야 함

## 유의사항

- 현재는 **선택한 행 기준으로 같은 견적번호를 가진 모든 행을 묶어 출력**합니다.
- PDF는 생성 즉시 **구글 드라이브 루트의 `견적서/` 폴더**에 저장됩니다.
- 파일명은 **견적번호.pdf**이며, 동일 이름이 있으면 **덮어쓰기(휴지통 처리 후 재생성)** 됩니다.
- `견적서` 메뉴는 스프레드시트를 열 때마다 생성됩니다.

## 공개용 이관 메모

- 공개 레포에는 **코드와 템플릿 파일만 이관**합니다. (커밋 히스토리는 포함하지 않음)
- README에는 **실제 고객/업체 정보나 시트 ID**를 넣지 않습니다.
- `template preview.html`은 새 레포에서 샘플 데이터로 다시 만듭니다.
